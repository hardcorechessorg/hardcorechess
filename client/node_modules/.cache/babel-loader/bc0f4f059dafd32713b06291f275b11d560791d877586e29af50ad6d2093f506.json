{"ast":null,"code":"import React,{useState,useEffect,useMemo,useRef}from'react';import{Chessboard}from'react-chessboard';import{Chess}from'chess.js';import{useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const formatMs=ms=>{const s=Math.max(0,Math.floor(ms/1000));const m=Math.floor(s/60);const sec=s%60;return\"\".concat(m,\":\").concat(sec.toString().padStart(2,'0'));};const pairMoves=sans=>{const rows=[];for(let i=0;i<sans.length;i+=2){rows.push({no:Math.floor(i/2)+1,w:sans[i]||'',b:sans[i+1]||''});}return rows;};const ComputerGame=()=>{const navigate=useNavigate();const[game,setGame]=useState(new Chess());const[difficulty,setDifficulty]=useState(5);const[isGameOver,setIsGameOver]=useState(false);const[result,setResult]=useState(null);const[isThinking,setIsThinking]=useState(false);const[playerColor,setPlayerColor]=useState('w');// w - белые, b - черные\nconst[isStockfishReady,setIsStockfishReady]=useState(false);const[isLoadingStockfish,setIsLoadingStockfish]=useState(true);const stockfishRef=useRef(null);// Контроль времени\nconst[minutes,setMinutes]=useState(5);const[increment,setIncrement]=useState(0);const[clock,setClock]=useState({wMs:minutes*60000,bMs:minutes*60000});const[lastTurnStartAt,setLastTurnStartAt]=useState(null);const[tick,setTick]=useState(0);// История ходов (SAN)\nconst[movesSan,setMovesSan]=useState([]);// Инициализация Stockfish\nuseEffect(()=>{const initStockfish=async()=>{try{setIsLoadingStockfish(true);// Динамический импорт Stockfish\nconst StockfishModule=await import('stockfish/src/stockfish-nnue-16.js');const Stockfish=StockfishModule.default||StockfishModule.Stockfish||StockfishModule;const stockfish=new Stockfish();stockfishRef.current=stockfish;stockfish.onmessage=event=>{const message=event.data||event;console.log('Stockfish message:',message);if(message.includes('uciok')){setIsStockfishReady(true);setIsLoadingStockfish(false);}};stockfish.postMessage('uci');}catch(error){console.error('Ошибка инициализации Stockfish:',error);setIsLoadingStockfish(false);}};initStockfish();return()=>{if(stockfishRef.current){stockfishRef.current.terminate();}};},[]);useEffect(()=>{if(isStockfishReady){startNewGame();}},[isStockfishReady]);useEffect(()=>{if(!isGameOver&&playerColor==='b'&&game.turn()==='w'){makeComputerMove();}},[playerColor]);useEffect(()=>{const id=setInterval(()=>setTick(t=>t+1),200);return()=>clearInterval(id);},[]);const displayedClock=useMemo(()=>{if(isGameOver||lastTurnStartAt==null)return clock;const now=Date.now();const elapsed=Math.max(0,now-lastTurnStartAt);if(game.turn()==='w'){return{wMs:Math.max(0,clock.wMs-elapsed),bMs:clock.bMs};}else{return{wMs:clock.wMs,bMs:Math.max(0,clock.bMs-elapsed)};}},[clock,lastTurnStartAt,isGameOver,game,tick]);const resetClocks=(mins,inc)=>{const ms=mins*60000;setClock({wMs:ms,bMs:ms});setLastTurnStartAt(Date.now());};const startNewGame=()=>{const newGame=new Chess();setGame(newGame);setIsGameOver(false);setResult(null);setIsThinking(false);setMovesSan([]);resetClocks(minutes,increment);if(playerColor==='b'){setTimeout(()=>makeComputerMove(),50);}};const finishOnTime=loser=>{setIsGameOver(true);setResult(loser==='w'?'Поражение по времени (белые)':'Поражение по времени (чёрные)');};const settleTimeAfterMove=movedColor=>{const now=Date.now();if(lastTurnStartAt!=null){const elapsed=now-lastTurnStartAt;if(movedColor==='w'){const newW=Math.max(0,clock.wMs-elapsed)+increment*1000;if(newW<=0){finishOnTime('w');return false;}setClock({wMs:newW,bMs:clock.bMs});}else{const newB=Math.max(0,clock.bMs-elapsed)+increment*1000;if(newB<=0){finishOnTime('b');return false;}setClock({wMs:clock.wMs,bMs:newB});}}setLastTurnStartAt(now);return true;};const makeComputerMove=async()=>{if(isGameOver||game.isGameOver()||!isStockfishReady||!stockfishRef.current)return;if(game.turn()!==playerColor){const now=Date.now();if(lastTurnStartAt!=null){const elapsed=now-lastTurnStartAt;const compColor=playerColor==='w'?'b':'w';const compMs=compColor==='w'?clock.wMs:clock.bMs;if(compMs-elapsed<=0){finishOnTime(compColor);return;}}}setIsThinking(true);return new Promise(resolve=>{const stockfish=stockfishRef.current;let bestMove=null;const handleMessage=event=>{const message=event.data||event;if(message.includes('bestmove')){const parts=message.split(' ');if(parts.length>=2){bestMove=parts[1];}stockfish.removeEventListener('message',handleMessage);if(bestMove&&bestMove!=='null'){try{const move=game.move(bestMove);if(move){setMovesSan(prev=>[...prev,move.san]);setGame(new Chess(game.fen()));const compColor=move.color;if(!settleTimeAfterMove(compColor)){setIsThinking(false);resolve();return;}if(game.isGameOver()){setIsGameOver(true);if(game.isCheckmate()){setResult(playerColor==='w'?'Победа чёрных!':'Победа белых!');}else if(game.isDraw()){setResult('Ничья!');}}}}catch(error){console.error('Ошибка выполнения хода:',error);}}setIsThinking(false);resolve();}};stockfish.addEventListener('message',handleMessage);// Настройка сложности через UCI параметры\nconst depth=difficulty>=9?15:difficulty>=7?12:difficulty>=4?8:4;const skillLevel=Math.min(20,difficulty*2);stockfish.postMessage('setoption name Skill Level value '+skillLevel);stockfish.postMessage('position fen '+game.fen());stockfish.postMessage('go depth '+depth);});};const handleMove=async(sourceSquare,targetSquare)=>{if(isGameOver||isThinking)return false;if(game.turn()!==playerColor)return false;const move=game.move({from:sourceSquare,to:targetSquare});if(!move)return false;setMovesSan(prev=>[...prev,move.san]);setGame(new Chess(game.fen()));if(!settleTimeAfterMove(move.color))return true;if(game.isGameOver()){setIsGameOver(true);if(game.isCheckmate()){setResult(playerColor==='w'?'Победа белых!':'Победа чёрных!');}else if(game.isDraw()){setResult('Ничья!');}return true;}setTimeout(()=>{makeComputerMove();},200);return true;};const changeDifficulty=newDifficulty=>{setDifficulty(newDifficulty);startNewGame();};const changePlayerColor=color=>{setPlayerColor(color);startNewGame();};const rows=useMemo(()=>pairMoves(movesSan),[movesSan]);return/*#__PURE__*/_jsxs(\"div\",{className:\"section\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/'),className:\"button\",style:{marginBottom:12},children:\"\\u041D\\u0430\\u0437\\u0430\\u0434\"}),/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0418\\u0433\\u0440\\u0430 \\u043F\\u0440\\u043E\\u0442\\u0438\\u0432 \\u043A\\u043E\\u043C\\u043F\\u044C\\u044E\\u0442\\u0435\\u0440\\u0430\"}),isLoadingStockfish&&/*#__PURE__*/_jsx(\"div\",{className:\"panel\",style:{marginBottom:16,color:'#8ab4f8'},children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 Stockfish WASM \\u043C\\u043E\\u0434\\u0443\\u043B\\u044F...\"}),!isStockfishReady&&!isLoadingStockfish&&/*#__PURE__*/_jsxs(\"div\",{className:\"panel\",style:{marginBottom:16,color:'#ff8a80'},children:[\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430 \\u0437\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0438 Stockfish. \\u041F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043E\\u0431\\u043D\\u043E\\u0432\\u0438\\u0442\\u044C \\u0441\\u0442\\u0440\\u0430\\u043D\\u0438\\u0446\\u0443.\",/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"small\",{children:\"\\u0415\\u0441\\u043B\\u0438 \\u043F\\u0440\\u043E\\u0431\\u043B\\u0435\\u043C\\u0430 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u044F\\u0435\\u0442\\u0441\\u044F, \\u043F\\u043E\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u0434\\u0440\\u0443\\u0433\\u043E\\u0439 \\u0431\\u0440\\u0430\\u0443\\u0437\\u0435\\u0440 \\u0438\\u043B\\u0438 \\u043E\\u0442\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u0435 \\u0431\\u043B\\u043E\\u043A\\u0438\\u0440\\u043E\\u0432\\u0449\\u0438\\u043A\\u0438 \\u0440\\u0435\\u043A\\u043B\\u0430\\u043C\\u044B.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-layout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"game-board\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',gap:16,marginBottom:16,flexWrap:'wrap'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel\",children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',marginBottom:6,fontWeight:'bold'},children:[\"\\u0421\\u043B\\u043E\\u0436\\u043D\\u043E\\u0441\\u0442\\u044C: \",difficulty,\"/10\"]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"1\",max:\"10\",value:difficulty,onChange:e=>changeDifficulty(parseInt(e.target.value)),style:{width:180}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel\",children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:6,fontWeight:'bold'},children:\"\\u0426\\u0432\\u0435\\u0442 \\u0444\\u0438\\u0433\\u0443\\u0440:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>changePlayerColor('w'),className:\"button \".concat(playerColor==='w'?'primary':''),children:\"\\u0411\\u0435\\u043B\\u044B\\u0435\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>changePlayerColor('b'),className:\"button \".concat(playerColor==='b'?'primary':''),children:\"\\u0427\\u0451\\u0440\\u043D\\u044B\\u0435\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel\",children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:6,fontWeight:'bold'},children:\"\\u041A\\u043E\\u043D\\u0442\\u0440\\u043E\\u043B\\u044C \\u0432\\u0440\\u0435\\u043C\\u0435\\u043D\\u0438\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:1,max:180,value:minutes,onChange:e=>{setMinutes(Number(e.target.value));resetClocks(Number(e.target.value),increment);},style:{width:80,padding:'8px',borderRadius:6,border:'1px solid #3a3a3a',background:'#2a2a2a',color:'#e6e6e6'}}),/*#__PURE__*/_jsx(\"span\",{className:\"kicker\",children:\"+\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:0,max:60,value:increment,onChange:e=>{setIncrement(Number(e.target.value));},style:{width:100,padding:'8px',borderRadius:6,border:'1px solid #3a3a3a',background:'#2a2a2a',color:'#e6e6e6'}}),/*#__PURE__*/_jsx(\"span\",{className:\"kicker\",children:\"\\u0441\\u0435\\u043A\"})]})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:startNewGame,className:\"button\",style:{marginBottom:12},children:\"\\u041D\\u043E\\u0432\\u0430\\u044F \\u0438\\u0433\\u0440\\u0430\"}),/*#__PURE__*/_jsx(\"div\",{className:\"board-responsive\",children:/*#__PURE__*/_jsx(Chessboard,{position:game.fen(),onPieceDrop:handleMove,boardWidth:650,boardOrientation:playerColor==='w'?'white':'black'})}),isGameOver&&/*#__PURE__*/_jsx(\"div\",{className:\"panel\",style:{marginTop:12,color:'#ff8a80',fontWeight:'bold'},children:result}),isThinking&&/*#__PURE__*/_jsx(\"div\",{className:\"panel\",style:{marginTop:12,color:'#8ab4f8'},children:\"\\u041A\\u043E\\u043C\\u043F\\u044C\\u044E\\u0442\\u0435\\u0440 \\u0430\\u043D\\u0430\\u043B\\u0438\\u0437\\u0438\\u0440\\u0443\\u0435\\u0442 \\u043F\\u043E\\u0437\\u0438\\u0446\\u0438\\u044E\\u2026\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"game-sidebar\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel game-clock\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"\\u0427\\u0430\\u0441\\u044B\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:8},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0411\\u0435\\u043B\\u044B\\u0435\"}),/*#__PURE__*/_jsx(\"strong\",{children:formatMs(displayedClock.wMs)})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u0427\\u0451\\u0440\\u043D\\u044B\\u0435\"}),/*#__PURE__*/_jsx(\"strong\",{children:formatMs(displayedClock.bMs)})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"panel game-history\",children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"\\u0418\\u0441\\u0442\\u043E\\u0440\\u0438\\u044F \\u0445\\u043E\\u0434\\u043E\\u0432\"}),rows.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"kicker\",children:\"\\u041F\\u043E\\u043A\\u0430 \\u043D\\u0435\\u0442 \\u0445\\u043E\\u0434\\u043E\\u0432\"}):/*#__PURE__*/_jsxs(\"table\",{style:{width:'100%',borderCollapse:'collapse'},children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{style:{textAlign:'left',width:40},children:\"#\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:'left'},children:\"\\u0411\\u0435\\u043B\\u044B\\u0435\"}),/*#__PURE__*/_jsx(\"th\",{style:{textAlign:'left'},children:\"\\u0427\\u0451\\u0440\\u043D\\u044B\\u0435\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:rows.map(r=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsxs(\"td\",{children:[r.no,\".\"]}),/*#__PURE__*/_jsx(\"td\",{children:r.w}),/*#__PURE__*/_jsx(\"td\",{children:r.b})]},r.no))})]})]})]})]})]});};export default ComputerGame;","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","Chessboard","Chess","useNavigate","jsx","_jsx","jsxs","_jsxs","formatMs","ms","s","Math","max","floor","m","sec","concat","toString","padStart","pairMoves","sans","rows","i","length","push","no","w","b","ComputerGame","navigate","game","setGame","difficulty","setDifficulty","isGameOver","setIsGameOver","result","setResult","isThinking","setIsThinking","playerColor","setPlayerColor","isStockfishReady","setIsStockfishReady","isLoadingStockfish","setIsLoadingStockfish","stockfishRef","minutes","setMinutes","increment","setIncrement","clock","setClock","wMs","bMs","lastTurnStartAt","setLastTurnStartAt","tick","setTick","movesSan","setMovesSan","initStockfish","StockfishModule","Stockfish","default","stockfish","current","onmessage","event","message","data","console","log","includes","postMessage","error","terminate","startNewGame","turn","makeComputerMove","id","setInterval","t","clearInterval","displayedClock","now","Date","elapsed","resetClocks","mins","inc","newGame","setTimeout","finishOnTime","loser","settleTimeAfterMove","movedColor","newW","newB","compColor","compMs","Promise","resolve","bestMove","handleMessage","parts","split","removeEventListener","move","prev","san","fen","color","isCheckmate","isDraw","addEventListener","depth","skillLevel","min","handleMove","sourceSquare","targetSquare","from","to","changeDifficulty","newDifficulty","changePlayerColor","className","children","onClick","style","marginBottom","display","justifyContent","gap","flexWrap","fontWeight","type","value","onChange","e","parseInt","target","width","alignItems","Number","padding","borderRadius","border","background","position","onPieceDrop","boardWidth","boardOrientation","marginTop","flexDirection","borderCollapse","textAlign","map","r"],"sources":["/home/kirtan-rasa/hardcorechess/client/src/components/ComputerGame.js"],"sourcesContent":["import React, { useState, useEffect, useMemo, useRef } from 'react';\nimport { Chessboard } from 'react-chessboard';\nimport { Chess } from 'chess.js';\nimport { useNavigate } from 'react-router-dom';\n\nconst formatMs = (ms) => {\n  const s = Math.max(0, Math.floor(ms / 1000));\n  const m = Math.floor(s / 60);\n  const sec = s % 60;\n  return `${m}:${sec.toString().padStart(2, '0')}`;\n};\n\nconst pairMoves = (sans) => {\n  const rows = [];\n  for (let i = 0; i < sans.length; i += 2) {\n    rows.push({ no: Math.floor(i / 2) + 1, w: sans[i] || '', b: sans[i + 1] || '' });\n  }\n  return rows;\n};\n\nconst ComputerGame = () => {\n  const navigate = useNavigate();\n  const [game, setGame] = useState(new Chess());\n  const [difficulty, setDifficulty] = useState(5);\n  const [isGameOver, setIsGameOver] = useState(false);\n  const [result, setResult] = useState(null);\n  const [isThinking, setIsThinking] = useState(false);\n  const [playerColor, setPlayerColor] = useState('w'); // w - белые, b - черные\n  const [isStockfishReady, setIsStockfishReady] = useState(false);\n  const [isLoadingStockfish, setIsLoadingStockfish] = useState(true);\n  const stockfishRef = useRef(null);\n\n  // Контроль времени\n  const [minutes, setMinutes] = useState(5);\n  const [increment, setIncrement] = useState(0);\n  const [clock, setClock] = useState({ wMs: minutes * 60000, bMs: minutes * 60000 });\n  const [lastTurnStartAt, setLastTurnStartAt] = useState(null);\n  const [tick, setTick] = useState(0);\n\n  // История ходов (SAN)\n  const [movesSan, setMovesSan] = useState([]);\n\n  // Инициализация Stockfish\n  useEffect(() => {\n    const initStockfish = async () => {\n      try {\n        setIsLoadingStockfish(true);\n        \n        // Динамический импорт Stockfish\n        const StockfishModule = await import('stockfish/src/stockfish-nnue-16.js');\n        const Stockfish = StockfishModule.default || StockfishModule.Stockfish || StockfishModule;\n        \n        const stockfish = new Stockfish();\n        stockfishRef.current = stockfish;\n        \n        stockfish.onmessage = (event) => {\n          const message = event.data || event;\n          console.log('Stockfish message:', message);\n          if (message.includes('uciok')) {\n            setIsStockfishReady(true);\n            setIsLoadingStockfish(false);\n          }\n        };\n        \n        stockfish.postMessage('uci');\n      } catch (error) {\n        console.error('Ошибка инициализации Stockfish:', error);\n        setIsLoadingStockfish(false);\n      }\n    };\n    \n    initStockfish();\n    \n    return () => {\n      if (stockfishRef.current) {\n        stockfishRef.current.terminate();\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (isStockfishReady) {\n      startNewGame();\n    }\n  }, [isStockfishReady]);\n\n  useEffect(() => {\n    if (!isGameOver && playerColor === 'b' && game.turn() === 'w') {\n      makeComputerMove();\n    }\n  }, [playerColor]);\n\n  useEffect(() => {\n    const id = setInterval(() => setTick((t) => t + 1), 200);\n    return () => clearInterval(id);\n  }, []);\n\n  const displayedClock = useMemo(() => {\n    if (isGameOver || lastTurnStartAt == null) return clock;\n    const now = Date.now();\n    const elapsed = Math.max(0, now - lastTurnStartAt);\n    if (game.turn() === 'w') {\n      return { wMs: Math.max(0, clock.wMs - elapsed), bMs: clock.bMs };\n    } else {\n      return { wMs: clock.wMs, bMs: Math.max(0, clock.bMs - elapsed) };\n    }\n  }, [clock, lastTurnStartAt, isGameOver, game, tick]);\n\n  const resetClocks = (mins, inc) => {\n    const ms = mins * 60000;\n    setClock({ wMs: ms, bMs: ms });\n    setLastTurnStartAt(Date.now());\n  };\n\n  const startNewGame = () => {\n    const newGame = new Chess();\n    setGame(newGame);\n    setIsGameOver(false);\n    setResult(null);\n    setIsThinking(false);\n    setMovesSan([]);\n    resetClocks(minutes, increment);\n    if (playerColor === 'b') {\n      setTimeout(() => makeComputerMove(), 50);\n    }\n  };\n\n  const finishOnTime = (loser) => {\n    setIsGameOver(true);\n    setResult(loser === 'w' ? 'Поражение по времени (белые)' : 'Поражение по времени (чёрные)');\n  };\n\n  const settleTimeAfterMove = (movedColor) => {\n    const now = Date.now();\n    if (lastTurnStartAt != null) {\n      const elapsed = now - lastTurnStartAt;\n      if (movedColor === 'w') {\n        const newW = Math.max(0, clock.wMs - elapsed) + increment * 1000;\n        if (newW <= 0) { finishOnTime('w'); return false; }\n        setClock({ wMs: newW, bMs: clock.bMs });\n      } else {\n        const newB = Math.max(0, clock.bMs - elapsed) + increment * 1000;\n        if (newB <= 0) { finishOnTime('b'); return false; }\n        setClock({ wMs: clock.wMs, bMs: newB });\n      }\n    }\n    setLastTurnStartAt(now);\n    return true;\n  };\n\n  const makeComputerMove = async () => {\n    if (isGameOver || game.isGameOver() || !isStockfishReady || !stockfishRef.current) return;\n\n    if (game.turn() !== playerColor) {\n      const now = Date.now();\n      if (lastTurnStartAt != null) {\n        const elapsed = now - lastTurnStartAt;\n        const compColor = playerColor === 'w' ? 'b' : 'w';\n        const compMs = compColor === 'w' ? clock.wMs : clock.bMs;\n        if (compMs - elapsed <= 0) {\n          finishOnTime(compColor);\n          return;\n        }\n      }\n    }\n\n    setIsThinking(true);\n    \n    return new Promise((resolve) => {\n      const stockfish = stockfishRef.current;\n      let bestMove = null;\n      \n      const handleMessage = (event) => {\n        const message = event.data || event;\n        \n        if (message.includes('bestmove')) {\n          const parts = message.split(' ');\n          if (parts.length >= 2) {\n            bestMove = parts[1];\n          }\n          \n          stockfish.removeEventListener('message', handleMessage);\n          \n          if (bestMove && bestMove !== 'null') {\n            try {\n              const move = game.move(bestMove);\n              if (move) {\n                setMovesSan(prev => [...prev, move.san]);\n                setGame(new Chess(game.fen()));\n                const compColor = move.color;\n                if (!settleTimeAfterMove(compColor)) {\n                  setIsThinking(false);\n                  resolve();\n                  return;\n                }\n\n                if (game.isGameOver()) {\n                  setIsGameOver(true);\n                  if (game.isCheckmate()) {\n                    setResult(playerColor === 'w' ? 'Победа чёрных!' : 'Победа белых!');\n                  } else if (game.isDraw()) {\n                    setResult('Ничья!');\n                  }\n                }\n              }\n            } catch (error) {\n              console.error('Ошибка выполнения хода:', error);\n            }\n          }\n          \n          setIsThinking(false);\n          resolve();\n        }\n      };\n      \n      stockfish.addEventListener('message', handleMessage);\n      \n      // Настройка сложности через UCI параметры\n      const depth = difficulty >= 9 ? 15 : difficulty >= 7 ? 12 : difficulty >= 4 ? 8 : 4;\n      const skillLevel = Math.min(20, difficulty * 2);\n      \n      stockfish.postMessage('setoption name Skill Level value ' + skillLevel);\n      stockfish.postMessage('position fen ' + game.fen());\n      stockfish.postMessage('go depth ' + depth);\n    });\n  };\n\n  const handleMove = async (sourceSquare, targetSquare) => {\n    if (isGameOver || isThinking) return false;\n    if (game.turn() !== playerColor) return false;\n\n    const move = game.move({ from: sourceSquare, to: targetSquare });\n    if (!move) return false;\n\n    setMovesSan(prev => [...prev, move.san]);\n    setGame(new Chess(game.fen()));\n\n    if (!settleTimeAfterMove(move.color)) return true;\n\n    if (game.isGameOver()) {\n      setIsGameOver(true);\n      if (game.isCheckmate()) {\n        setResult(playerColor === 'w' ? 'Победа белых!' : 'Победа чёрных!');\n      } else if (game.isDraw()) {\n        setResult('Ничья!');\n      }\n      return true;\n    }\n\n    setTimeout(() => { makeComputerMove(); }, 200);\n    return true;\n  };\n\n  const changeDifficulty = (newDifficulty) => {\n    setDifficulty(newDifficulty);\n    startNewGame();\n  };\n\n  const changePlayerColor = (color) => {\n    setPlayerColor(color);\n    startNewGame();\n  };\n\n  const rows = useMemo(() => pairMoves(movesSan), [movesSan]);\n\n  return (\n    <div className=\"section\">\n      <button \n        onClick={() => navigate('/')}\n        className=\"button\"\n        style={{ marginBottom: 12 }}\n      >\n        Назад\n      </button>\n      \n      <h2>Игра против компьютера</h2>\n\n      {isLoadingStockfish && (\n        <div className=\"panel\" style={{ marginBottom: 16, color: '#8ab4f8' }}>\n          Загрузка Stockfish WASM модуля...\n        </div>\n      )}\n\n      {!isStockfishReady && !isLoadingStockfish && (\n        <div className=\"panel\" style={{ marginBottom: 16, color: '#ff8a80' }}>\n          Ошибка загрузки Stockfish. Попробуйте обновить страницу.\n          <br />\n          <small>Если проблема повторяется, попробуйте другой браузер или отключите блокировщики рекламы.</small>\n        </div>\n      )}\n\n      <div className=\"game-layout\">\n        <div className=\"game-board\">\n          <div style={{ display: 'flex', justifyContent: 'center', gap: 16, marginBottom: 16, flexWrap: 'wrap' }}>\n            <div className=\"panel\">\n              <label style={{ display: 'block', marginBottom: 6, fontWeight: 'bold' }}>\n                Сложность: {difficulty}/10\n              </label>\n              <input\n                type=\"range\"\n                min=\"1\"\n                max=\"10\"\n                value={difficulty}\n                onChange={(e) => changeDifficulty(parseInt(e.target.value))}\n                style={{ width: 180 }}\n              />\n            </div>\n            \n            <div className=\"panel\">\n              <label style={{ display: 'block', marginBottom: 6, fontWeight: 'bold' }}>\n                Цвет фигур:\n              </label>\n              <div style={{ display: 'flex', gap: 8 }}>\n                <button\n                  onClick={() => changePlayerColor('w')}\n                  className={`button ${playerColor === 'w' ? 'primary' : ''}`}\n                >\n                  Белые\n                </button>\n                <button\n                  onClick={() => changePlayerColor('b')}\n                  className={`button ${playerColor === 'b' ? 'primary' : ''}`}\n                >\n                  Чёрные\n                </button>\n              </div>\n            </div>\n\n            <div className=\"panel\">\n              <label style={{ display: 'block', marginBottom: 6, fontWeight: 'bold' }}>Контроль времени</label>\n              <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n                <input type=\"number\" min={1} max={180} value={minutes}\n                  onChange={(e) => { setMinutes(Number(e.target.value)); resetClocks(Number(e.target.value), increment); }}\n                  style={{ width: 80, padding: '8px', borderRadius: 6, border: '1px solid #3a3a3a', background: '#2a2a2a', color: '#e6e6e6' }} />\n                <span className=\"kicker\">+</span>\n                <input type=\"number\" min={0} max={60} value={increment}\n                  onChange={(e) => { setIncrement(Number(e.target.value)); }}\n                  style={{ width: 100, padding: '8px', borderRadius: 6, border: '1px solid #3a3a3a', background: '#2a2a2a', color: '#e6e6e6' }} />\n                <span className=\"kicker\">сек</span>\n              </div>\n            </div>\n          </div>\n          \n          <button onClick={startNewGame} className=\"button\" style={{ marginBottom: 12 }}>\n            Новая игра\n          </button>\n          \n          <div className=\"board-responsive\">\n            <Chessboard\n              position={game.fen()}\n              onPieceDrop={handleMove}\n              boardWidth={650}\n              boardOrientation={playerColor === 'w' ? 'white' : 'black'}\n            />\n          </div>\n\n          {isGameOver && (\n            <div className=\"panel\" style={{ marginTop: 12, color: '#ff8a80', fontWeight: 'bold' }}>\n              {result}\n            </div>\n          )}\n          \n          {isThinking && (\n            <div className=\"panel\" style={{ marginTop: 12, color: '#8ab4f8' }}>\n              Компьютер анализирует позицию…\n            </div>\n          )}\n        </div>\n\n        <div className=\"game-sidebar\">\n          <div className=\"panel game-clock\">\n            <h3 style={{ marginTop: 0 }}>Часы</h3>\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                <span>Белые</span>\n                <strong>{formatMs(displayedClock.wMs)}</strong>\n              </div>\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                <span>Чёрные</span>\n                <strong>{formatMs(displayedClock.bMs)}</strong>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"panel game-history\">\n            <h3 style={{ marginTop: 0 }}>История ходов</h3>\n            {rows.length === 0 ? (\n              <p className=\"kicker\">Пока нет ходов</p>\n            ) : (\n              <table style={{ width: '100%', borderCollapse: 'collapse' }}>\n                <thead>\n                  <tr>\n                    <th style={{ textAlign: 'left', width: 40 }}>#</th>\n                    <th style={{ textAlign: 'left' }}>Белые</th>\n                    <th style={{ textAlign: 'left' }}>Чёрные</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r) => (\n                    <tr key={r.no}>\n                      <td>{r.no}.</td>\n                      <td>{r.w}</td>\n                      <td>{r.b}</td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ComputerGame;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}